<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DECTERUM</title>
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/css/modules/feed.css">
    <link rel="stylesheet" href="/static/css/modules/videos.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <div class="app-header">
            <div class="app-title">DECTERUM</div>
            <div class="connection-status">
                <div class="status-dot" id="status-dot"></div>
                <span id="status-text">Connecting</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Chat Section -->
            <div class="section active" id="chat-section">
                <div class="chat-section">
                    <!-- Contacts View -->
                    <div id="contacts-view">
                        <div class="section-header">
                            <div class="section-title">Messages</div>
                            <button class="btn btn-primary" onclick="showAddContactModal()">
                                Add Contact
                            </button>
                        </div>
                        <div class="contacts-list" id="contacts-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">üí¨</div>
                                <h3>No conversations</h3>
                                <p>Add contacts to start messaging</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Messages View -->
                    <div id="chat-view" class="hidden">
                        <div class="section-header">
                            <div style="display: flex; align-items: center; gap: var(--spacing-3);">
                                <button class="btn-icon" onclick="showContactsList()">‚Üê</button>
                                <span class="section-title" id="chat-contact-name">Chat</span>
                            </div>
                        </div>
                        <div class="chat-messages" id="messages-container">
                            <div class="empty-state">
                                <div class="empty-state-icon">üí¨</div>
                                <h3>Start a conversation</h3>
                                <p>Type a message to begin</p>
                            </div>
                        </div>
                        <div class="message-input-container">
                            <textarea 
                                class="message-input" 
                                id="message-input"
                                placeholder="Type a message..."
                                disabled
                                rows="1"
                            ></textarea>
                            <button class="send-btn" id="send-btn" onclick="sendMessage()" disabled>
                                ‚Üó
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feed Section -->
            <div class="section" id="feed-section">
                <!-- O conte√∫do do feed ser√° carregado dinamicamente -->
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Carregando m√≥dulo do feed...</p>
                </div>
            </div>

            <!-- Videos Section -->
            <div class="section" id="videos-section">
                <!-- ========== VIDEO MODULE HTML - YOUTUBE STYLE ========== -->

                <!-- Video Section -->
                <section class="videos-section">

                    <!-- Video Header -->
                    <div class="videos-header">
                        <div class="videos-header-content">
                            <h1 class="videos-title">DECTERUM Videos</h1>
                            <div class="videos-controls">
                                <button class="video-view-btn active" data-view="home">
                                    <span class="icon">üè†</span>
                                    <span>In√≠cio</span>
                                </button>
                                <button class="video-view-btn" data-view="shorts">
                                    <span class="icon">üì±</span>
                                    <span>Shorts</span>
                                </button>
                                <button class="video-view-btn" data-view="trending">
                                    <span class="icon">üî•</span>
                                    <span>Em Alta</span>
                                </button>
                                <button class="video-view-btn" data-view="upload">
                                    <span class="icon">üì§</span>
                                    <span>Upload</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Search Bar -->
                    <div class="video-search-bar">
                        <input type="text" id="video-search-input" placeholder="Buscar v√≠deos..." />
                        <button id="video-search-btn" class="search-btn">
                            <span class="icon">üîç</span>
                        </button>
                        <div class="search-filters">
                            <select id="video-type-filter">
                                <option value="">Todos os tipos</option>
                                <option value="short">Shorts</option>
                                <option value="long">V√≠deos longos</option>
                            </select>
                            <select id="video-category-filter">
                                <option value="">Todas as categorias</option>
                                <option value="gaming">Gaming</option>
                                <option value="music">M√∫sica</option>
                                <option value="education">Educa√ß√£o</option>
                                <option value="entertainment">Entretenimento</option>
                                <option value="news">Not√≠cias</option>
                                <option value="sports">Esportes</option>
                                <option value="technology">Tecnologia</option>
                                <option value="lifestyle">Estilo de Vida</option>
                                <option value="comedy">Com√©dia</option>
                                <option value="tutorial">Tutorial</option>
                            </select>
                        </div>
                    </div>

                    <!-- Video Views Container -->
                    <div class="video-views-container">

                        <!-- Home View -->
                        <div id="home-view" class="video-view active">
                            <div class="video-grid">
                                <!-- Videos will be populated here -->
                            </div>
                            <div class="load-more-container">
                                <button id="load-more-videos" class="load-more-btn">
                                    Carregar mais v√≠deos
                                </button>
                            </div>
                        </div>

                        <!-- Shorts View -->
                        <div id="shorts-view" class="video-view">
                            <div class="shorts-container">
                                <div class="shorts-player">
                                    <!-- Shorts player will be here -->
                                    <div class="shorts-loading">
                                        <div class="loading-spinner"></div>
                                        <p>Carregando shorts...</p>
                                    </div>
                                </div>
                                <div class="shorts-controls">
                                    <button class="shorts-nav-btn" id="shorts-prev">‚¨ÜÔ∏è</button>
                                    <button class="shorts-nav-btn" id="shorts-next">‚¨áÔ∏è</button>
                                </div>
                            </div>
                        </div>

                        <!-- Trending View -->
                        <div id="trending-view" class="video-view">
                            <div class="trending-header">
                                <h2>V√≠deos em Alta</h2>
                                <div class="trending-filters">
                                    <button class="trending-filter-btn active" data-filter="">Todos</button>
                                    <button class="trending-filter-btn" data-filter="short">Shorts</button>
                                    <button class="trending-filter-btn" data-filter="long">V√≠deos</button>
                                </div>
                            </div>
                            <div class="trending-grid">
                                <!-- Trending videos will be populated here -->
                            </div>
                        </div>

                        <!-- Upload View -->
                        <div id="upload-view" class="video-view">
                            <div class="upload-container">
                                <div class="upload-header">
                                    <h2>Enviar V√≠deo</h2>
                                    <p class="upload-subtitle">Compartilhe seu conte√∫do com a rede DECTERUM</p>
                                </div>

                                <form id="video-upload-form" class="upload-form">
                                    <!-- File Upload Area -->
                                    <div class="upload-area" id="video-upload-area">
                                        <div class="upload-icon">üìÅ</div>
                                        <p class="upload-text">Arraste um v√≠deo aqui ou clique para selecionar</p>
                                        <p class="upload-hint">Formatos suportados: MP4, WebM, AVI, MOV | M√°ximo: 10GB</p>
                                        <input type="file" id="video-file-input" accept="video/*" hidden>
                                    </div>

                                    <!-- Video Preview -->
                                    <div id="video-preview" class="video-preview" style="display: none;">
                                        <video id="preview-video" controls></video>
                                        <div class="video-info">
                                            <div class="video-meta">
                                                <span id="video-duration">Dura√ß√£o: --:--</span>
                                                <span id="video-size">Tamanho: -- MB</span>
                                                <span id="video-type-indicator">Tipo: --</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Thumbnail Upload -->
                                    <div class="thumbnail-upload">
                                        <label>Thumbnail (opcional)</label>
                                        <div class="thumbnail-area" id="thumbnail-upload-area">
                                            <div class="thumbnail-placeholder">
                                                <span class="icon">üñºÔ∏è</span>
                                                <span>Selecionar thumbnail</span>
                                            </div>
                                            <input type="file" id="thumbnail-file-input" accept="image/*" hidden>
                                        </div>
                                        <div id="thumbnail-preview" class="thumbnail-preview" style="display: none;">
                                            <img id="preview-thumbnail" alt="Thumbnail preview">
                                        </div>
                                    </div>

                                    <!-- Video Details -->
                                    <div class="video-details">
                                        <div class="form-group">
                                            <label for="video-title">T√≠tulo*</label>
                                            <input type="text" id="video-title" maxlength="200" required placeholder="Digite o t√≠tulo do v√≠deo...">
                                            <div class="char-count">
                                                <span id="title-count">0</span>/200
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="video-description">Descri√ß√£o</label>
                                            <textarea id="video-description" maxlength="5000" placeholder="Descreva seu v√≠deo..."></textarea>
                                            <div class="char-count">
                                                <span id="description-count">0</span>/5000
                                            </div>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="video-category">Categoria</label>
                                                <select id="video-category">
                                                    <option value="general">Geral</option>
                                                    <option value="gaming">Gaming</option>
                                                    <option value="music">M√∫sica</option>
                                                    <option value="education">Educa√ß√£o</option>
                                                    <option value="entertainment">Entretenimento</option>
                                                    <option value="news">Not√≠cias</option>
                                                    <option value="sports">Esportes</option>
                                                    <option value="technology">Tecnologia</option>
                                                    <option value="lifestyle">Estilo de Vida</option>
                                                    <option value="comedy">Com√©dia</option>
                                                    <option value="tutorial">Tutorial</option>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label for="video-visibility">Visibilidade</label>
                                                <select id="video-visibility">
                                                    <option value="public">P√∫blico</option>
                                                    <option value="private">Privado</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="video-tags">Tags (separadas por v√≠rgula)</label>
                                            <input type="text" id="video-tags" placeholder="tag1, tag2, tag3...">
                                            <div class="tags-preview" id="tags-preview"></div>
                                        </div>
                                    </div>

                                    <!-- Upload Actions -->
                                    <div class="upload-actions">
                                        <button type="button" id="cancel-upload" class="btn-secondary">
                                            Cancelar
                                        </button>
                                        <button type="submit" id="submit-upload" class="btn-primary" disabled>
                                            <span class="btn-text">Enviar V√≠deo</span>
                                            <span class="btn-loading" style="display: none;">
                                                <div class="loading-spinner small"></div>
                                                Enviando...
                                            </span>
                                        </button>
                                    </div>

                                    <!-- Upload Progress -->
                                    <div id="upload-progress" class="upload-progress" style="display: none;">
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="progress-fill"></div>
                                        </div>
                                        <div class="progress-text">
                                            <span id="progress-percentage">0%</span>
                                            <span id="progress-status">Preparando upload...</span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>

                    <!-- Video Player Modal -->
                    <div id="video-player-modal" class="video-modal" style="display: none;">
                        <div class="modal-backdrop" id="modal-backdrop"></div>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="modal-video-title">T√≠tulo do V√≠deo</h3>
                                <button class="modal-close-btn" id="modal-close-btn">‚úï</button>
                            </div>
                            <div class="modal-body">
                                <div class="video-player-container">
                                    <video id="modal-video-player" controls autoplay>
                                        <source id="modal-video-source" src="" type="video/mp4">
                                        Seu navegador n√£o suporta o elemento de v√≠deo.
                                    </video>
                                </div>
                                <div class="video-details-panel">
                                    <div class="video-info-section">
                                        <div class="video-author">
                                            <div class="author-avatar" id="modal-author-avatar">üë§</div>
                                            <div class="author-info">
                                                <div class="author-name" id="modal-author-name">Nome do Autor</div>
                                                <div class="video-stats">
                                                    <span id="modal-video-views">0 visualiza√ß√µes</span>
                                                    <span>‚Ä¢</span>
                                                    <span id="modal-video-date">h√° 1 dia</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="video-actions">
                                            <button class="action-btn like-btn" id="modal-like-btn">
                                                <span class="icon">üëç</span>
                                                <span id="modal-likes-count">0</span>
                                            </button>
                                            <button class="action-btn dislike-btn" id="modal-dislike-btn">
                                                <span class="icon">üëé</span>
                                                <span id="modal-dislikes-count">0</span>
                                            </button>
                                            <button class="action-btn share-btn" id="modal-share-btn">
                                                <span class="icon">üì§</span>
                                                Compartilhar
                                            </button>
                                        </div>
                                    </div>
                                    <div class="video-description-section">
                                        <div class="description-content" id="modal-video-description">
                                            Descri√ß√£o do v√≠deo aparecer√° aqui...
                                        </div>
                                        <div class="video-tags" id="modal-video-tags">
                                            <!-- Tags will be populated here -->
                                        </div>
                                    </div>
                                    <div class="comments-section">
                                        <div class="comments-header">
                                            <h4><span id="modal-comments-count">0</span> coment√°rios</h4>
                                        </div>
                                        <div class="comment-form">
                                            <textarea id="comment-input" placeholder="Adicione um coment√°rio..."></textarea>
                                            <div class="comment-actions">
                                                <button class="btn-secondary" id="cancel-comment">Cancelar</button>
                                                <button class="btn-primary" id="submit-comment">Comentar</button>
                                            </div>
                                        </div>
                                        <div class="comments-list" id="comments-list">
                                            <!-- Comments will be populated here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div id="videos-loading" class="loading-state" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p>Carregando v√≠deos...</p>
                    </div>

                    <!-- Empty State -->
                    <div id="videos-empty" class="empty-state" style="display: none;">
                        <div class="empty-icon">üìπ</div>
                        <h3>Nenhum v√≠deo encontrado</h3>
                        <p>Seja o primeiro a compartilhar um v√≠deo na rede!</p>
                        <button class="btn-primary" onclick="VideoModule.switchView('upload')">
                            Enviar V√≠deo
                        </button>
                    </div>

                </section>
            </div>

            <!-- Settings Section -->
            <div class="section" id="settings-section">
                <div class="settings-section">
                    <div class="settings-group">
                        <div class="settings-group-title">Profile</div>
                        <div class="settings-item">
                            <div class="settings-label">Username</div>
                            <div class="settings-value" id="user-username">‚Äî</div>
                        </div>
                        <div class="settings-item user-id-item">
                            <div class="settings-label">User ID</div>
                            <div class="settings-value-container">
                                <div class="settings-value" id="user-id" title="Click copy button to copy full ID">‚Äî</div>
                                <button class="btn-icon copy-btn" id="copy-user-id" onclick="copyUserId()" title="Copy User ID">
                                    üìã
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="settings-group-title">Network</div>
                        <div class="settings-item">
                            <div class="settings-label">Status</div>
                            <div class="settings-value" id="network-status">Offline</div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">Connected Peers</div>
                            <div class="settings-value" id="peers-count">0</div>
                        </div>
                        <div class="settings-item">
                            <div class="settings-label">Local Port</div>
                            <div class="settings-value" id="local-port">‚Äî</div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="settings-group-title">External Access</div>
                        <div class="settings-item">
                            <div class="settings-label">Cloudflare Tunnel</div>
                            <div class="settings-value" id="tunnel-status">Disabled</div>
                        </div>
                        <div class="settings-item" id="tunnel-url-item" style="display: none;">
                            <div class="settings-label">External URL</div>
                            <div class="settings-value-container">
                                <div class="settings-value" id="tunnel-url">‚Äî</div>
                                <button class="btn-icon copy-btn" onclick="copyTunnelUrl()" title="Copy Tunnel URL">
                                    üìã
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="settings-group-title">Actions</div>
                        <div class="settings-item">
                            <button class="btn btn-ghost" onclick="discoverPeers()" style="width: 100%;">
                                Discover Network Nodes
                            </button>
                        </div>
                        <div class="settings-item">
                            <button class="btn btn-ghost" onclick="showEditProfileModal()" style="width: 100%;">
                                Edit Profile
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchSection('chat')">
                <div class="nav-icon">üí¨</div>
                <div class="nav-label">Chat</div>
            </div>
            <div class="nav-item" onclick="switchSection('feed')">
                <div class="nav-icon">üìñ</div>
                <div class="nav-label">Feed</div>
            </div>
            <div class="nav-item" onclick="switchSection('videos')">
                <div class="nav-icon">üé¨</div>
                <div class="nav-label">Videos</div>
            </div>
            <div class="nav-item" onclick="switchSection('settings')">
                <div class="nav-icon">‚öô</div>
                <div class="nav-label">Settings</div>
            </div>
        </div>
    </div>

    <!-- Add Contact Modal -->
    <div class="modal" id="add-contact-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add Contact</div>
                <div class="modal-subtitle">Connect with other users on the network</div>
            </div>
            <form onsubmit="addContact(event)">
                <div class="form-group">
                    <label class="form-label">User ID</label>
                    <input type="text" class="form-input" id="contact-id" 
                           placeholder="paste-user-id-here" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Display Name</label>
                    <input type="text" class="form-input" id="contact-name" 
                           placeholder="What you want to call them" required>
                </div>
                <div class="button-actions">
                    <button type="button" class="btn btn-ghost" onclick="hideAddContactModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Add Contact
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="edit-profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Profile</div>
                <div class="modal-subtitle">Update your information</div>
            </div>
            <form onsubmit="updateProfile(event)">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="profile-username" 
                           placeholder="Your username" required>
                </div>
                <div class="button-actions">
                    <button type="button" class="btn btn-ghost" onclick="hideEditProfileModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Feed modals will be loaded dynamically -->

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toast-message"></span>
    </div>

    <script src="/static/js/module-loader.js"></script>
    <script src="/static/js/modules/feed.js"></script>
    <script src="/static/js/modules/video-demo-data.js"></script>
    <script src="/static/js/modules/videos.js"></script>
    <script src="/static/script.js"></script>

    <!-- Initialize Video Module -->
    <script>
        // Global flag to prevent multiple initializations
        window.videoModuleInitialized = false;

        function initializeVideoModule() {
            if (window.videoModuleInitialized) {
                console.log('üìπ VideoModule already initialized, skipping...');
                return;
            }

            if (document.getElementById('videos-section') && window.VideoModule) {
                console.log('üìπ VideoModule found, initializing...');
                try {
                    window.VideoModule.init();
                    window.videoModuleInitialized = true;
                    console.log('‚úÖ VideoModule initialized successfully');
                } catch (error) {
                    console.error('‚ùå Error initializing VideoModule:', error);
                }
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé¨ DOM ready, checking for video module...');

            // Try immediate initialization
            initializeVideoModule();

            // Fallback initialization with delay
            if (!window.videoModuleInitialized) {
                console.log('‚è≥ Waiting for VideoModule...');
                setTimeout(() => {
                    initializeVideoModule();
                }, 500);
            }
        });

        // Also expose function globally for manual initialization
        window.initializeVideoModule = initializeVideoModule;
    </script>
</body>
</html>